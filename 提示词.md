1. ğŸ“Œ æ ¸å¿ƒæç¤ºåŸåˆ™ï¼ˆCore Prompting Principlesï¼‰





æ˜ç¡®æŒ‡ä»¤ï¼ˆBe specificï¼‰ï¼šç¡®ä¿æç¤ºä¸­æ¸…æ¥šè¡¨è¾¾ä»»åŠ¡ç›®æ ‡ã€‚



æä¾›ç»“æ„ï¼ˆProvide structureï¼‰ï¼šé€šè¿‡ç¤ºä¾‹ã€æ¨¡æ¿ç­‰æ–¹å¼è®¾å®šé¢„æœŸè¾“å‡ºæ ¼å¼ã€‚



é¿å…æ­§ä¹‰ï¼ˆAvoid ambiguityï¼‰ï¼šä½¿ç”¨å…·ä½“è¯æ±‡ä¸ä¸Šä¸‹æ–‡é™ä½è¯¯è§£å¯èƒ½ã€‚



è®¾ç½®è§’è‰²ï¼ˆSet behavior/roleï¼‰ï¼šè®©æ¨¡å‹â€œæ‰®æ¼”æŸç§èº«ä»½â€ä»¥è°ƒæ•´é£æ ¼æˆ–å›ç­”æ–¹å¼ã€‚



é€æ­¥æŒ‡å¯¼ï¼ˆDecompose tasksï¼‰ï¼šå°†å¤æ‚ä»»åŠ¡æ‹†è§£æˆå¤šä¸ªå­ä»»åŠ¡ï¼Œæå‡ç²¾åº¦ã€‚

2. ğŸ“š æç¤ºç­–ç•¥å®ä¾‹ï¼ˆPrompting Strategiesï¼‰





Few-shot ç¤ºä¾‹ï¼šä½¿ç”¨å¤šä¸ªè¾“å…¥/è¾“å‡ºç¤ºä¾‹å¼•å¯¼æ¨¡å‹å­¦ä¹ ä»»åŠ¡ç»“æ„ã€‚



Chain-of-thoughtï¼ˆæ€ç»´é“¾ï¼‰æç¤ºï¼šå¼•å¯¼æ¨¡å‹æŒ‰é€»è¾‘é¡ºåºé€æ­¥æ¨ç†ï¼Œç‰¹åˆ«é€‚åˆå¤æ‚é—®é¢˜è§£å†³ã€‚



Refine promptsï¼ˆè¿­ä»£ä¼˜åŒ–ï¼‰ï¼šé€šè¿‡åé¦ˆä¸æ–­è°ƒæ•´æç¤ºå†…å®¹ä»¥è·å–æ›´ä¼˜ç»“æœã€‚



Internal monologueï¼šè®©æ¨¡å‹æ¨¡æ‹Ÿâ€œå†…å¿ƒæ€è€ƒè¿‡ç¨‹â€ä»¥è·å¾—æ›´æ·±å…¥åˆ†æã€‚



Critique and reviseï¼šè®©æ¨¡å‹å…ˆç”Ÿæˆå›ç­”ï¼Œå†è¿›è¡Œæ‰¹è¯„ã€ä¿®æ”¹ï¼Œæå‡ç­”æ¡ˆè´¨é‡ã€‚

3. ğŸ› ï¸ åº”ç”¨æŠ€å·§ï¼ˆPractical Tipsï¼‰





ä½¿ç”¨ "Let's think step by step" ç­‰è¯­å¥è¯±å¯¼æ›´å¥½æ¨ç†ã€‚



å°†æ¨¡å‹è¾“å‡ºé™åˆ¶ä¸º JSON æ ¼å¼æ—¶ï¼Œéœ€åŠ å…¥æ˜ç¡®çš„æ ¼å¼æè¿°ä¸ç¤ºä¾‹ã€‚



å¯¹äºå¤šæ­¥éª¤ä»»åŠ¡ï¼Œæœ€å¥½æ˜ç¡®åˆ—å‡ºæ¯ä¸ªé˜¶æ®µçš„è¦æ±‚ã€‚



è¯„ä¼°æç¤ºæ•ˆæœéœ€ç»“åˆè´¨é‡ã€ç¨³å®šæ€§ä¸æˆæœ¬ã€‚

å¥½çš„ï¼æˆ‘ä»¬æ¥åšä¸€ä¸ªæ›´è¯¦ç»†åˆé€šä¿—æ˜“æ‡‚çš„åˆ†è§£ï¼ŒæŠŠè¿™ä¸ª Notebook å½“ä½œæ˜¯ä¸€æœ¬ â€œå’ŒGPT-4æ‰“äº¤é“çš„ç§˜ç±â€ï¼Œä¸€æ­¥æ­¥è®²æ¸…æ¥šæ¯ä¸ªè¦ç‚¹ï¼Œè®©ä½ è½»æ¾æŒæ¡æç¤ºå·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰æ€ä¹ˆåšæ‰æœ‰æ•ˆã€‚



ğŸ“ã€ŠGPT-4 æç¤ºæŒ‡å—ã€‹é€šä¿—è§£è¯»ç‰ˆ



ğŸ§± ä¸€ã€å†™å¥½æç¤ºçš„åŸºç¡€åŸåˆ™ï¼ˆäº”å¤§ç§˜ç±ï¼‰

è¿™äº›å°±åƒæ˜¯â€œå’ŒAIæ²Ÿé€šçš„é»„é‡‘æ³•åˆ™â€ï¼Œæ¯ä¸€æ¡éƒ½å¾ˆé‡è¦ï¼š

1. è¯´æ¸…æ¥šä½ è¦å¹²å•¥ï¼ˆBe Specificï¼‰





ä¸è¦ç¬¼ç»Ÿåœ°è¯´ï¼šâ€œè¯·å¸®æˆ‘å†™ä¸€ç¯‡æ–‡ç« ã€‚â€



è¦è¯´å¾—å…·ä½“ä¸€ç‚¹ï¼šâ€œè¯·å†™ä¸€ç¯‡å…³äºäººå·¥æ™ºèƒ½å¦‚ä½•æ”¹å˜æ•™è‚²çš„500å­—æ–‡ç« ï¼Œç”¨é«˜ä¸­ç”Ÿèƒ½æ‡‚çš„è¯­è¨€ã€‚â€

ğŸ‘‰ è¶Šå…·ä½“ï¼ŒAIè¶ŠçŸ¥é“ä½ æƒ³è¦ä»€ä¹ˆï¼Œç»“æœä¹Ÿè¶Šå¥½ã€‚



2. å‘Šè¯‰å®ƒæ€ä¹ˆåšã€é•¿ä»€ä¹ˆæ ·ï¼ˆProvide structureï¼‰





æ¯”å¦‚ä½ æƒ³è®©å®ƒç”Ÿæˆä¸€ä¸ªè¡¨æ ¼ã€æ¸…å•ã€æˆ–è€…å›ºå®šæ ¼å¼çš„æ–‡æœ¬ã€‚



ä½ å¯ä»¥å…ˆæä¾›ä¸€ä¸ªæ¨¡æ¿ï¼Œæˆ–è€…ç»™å®ƒä¸€ä¸ªä¾‹å­ã€‚

ğŸ§© ä¾‹å­ï¼š

è¯·ç”¨ä»¥ä¸‹æ ¼å¼å†™å‡ºäº”ç§æ°´æœï¼š

åç§° | é¢œè‰² | å‘³é“
è‹¹æœ | çº¢è‰² | é…¸ç”œ




3. ä¸è¦æ¨¡æ£±ä¸¤å¯ï¼ˆAvoid ambiguityï¼‰





å¦‚æœä½ è¯´â€œåˆ—å‡ºä¸€äº›é¡¹ç›®â€ï¼Œé‚£â€œé¡¹ç›®â€å¯èƒ½æŒ‡çš„æ˜¯â€œè®¡åˆ’é¡¹ç›®â€ã€ä¹Ÿå¯èƒ½æ˜¯â€œè½¯ä»¶é¡¹ç›®â€ï¼Œæ¨¡å‹ä¼šç³Šæ¶‚ã€‚



æ‰€ä»¥è¦å…·ä½“è¯´æ˜ä½ æ˜¯è¯´ä»€ä¹ˆã€‚

âœ… æ”¹æˆï¼šâ€œåˆ—å‡ºäº”ä¸ªå¼€æºçš„Pythoné¡¹ç›®ã€‚â€



4. è®©GPTæ‰®æ¼”ä¸€ä¸ªè§’è‰²ï¼ˆSet behavior/roleï¼‰





ä½ å¯ä»¥å‘Šè¯‰å®ƒï¼šâ€œä½ ç°åœ¨æ˜¯ä¸ªè‹±è¯­è€å¸ˆâ€ã€â€œä½ æ˜¯ä¸ªæ³•å¾‹é¡¾é—®â€ã€â€œä½ æ˜¯ä¸€ååŒ»ç”Ÿâ€ã€‚



å®ƒå°±ä¼šæŒ‰é‚£ä¸ªèº«ä»½å›ç­”ä½ ã€‚

ğŸ­ ç¤ºä¾‹ï¼š

ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šè¥å…»å¸ˆï¼Œè¯·ä¸ºæˆ‘åˆ¶å®šä¸€å‘¨çš„å¥åº·é¥®é£Ÿè®¡åˆ’ã€‚




5. æŠŠä»»åŠ¡æ‹†å¼€åšï¼ˆDecompose tasksï¼‰





æœ‰äº›é—®é¢˜å¤ªå¤æ‚ï¼ŒGPTä¸€ä¸‹å­å¤„ç†ä¸å¥½ã€‚



ä½ å¯ä»¥å…ˆè®©å®ƒåˆ†æé—®é¢˜ï¼Œå†è®©å®ƒè§£å†³ã€‚

ğŸªœ ä¸¾ä¸ªä¾‹å­ï¼š

ç¬¬ä¸€æ­¥ï¼šè¯·å…ˆåˆ—å‡ºå†™å•†ä¸šè®¡åˆ’ä¹¦éœ€è¦çš„è¦ç‚¹ã€‚
ç¬¬äºŒæ­¥ï¼šè¯·æ ¹æ®è¿™äº›è¦ç‚¹å¸®æˆ‘å†™ä¸€ä»½è®¡åˆ’ä¹¦ã€‚




ğŸ’¡ äºŒã€å®ç”¨æç¤ºæŠ€å·§ï¼ˆæ›´å¼ºæ›´é«˜çº§çš„ç”¨æ³•ï¼‰

è¿™äº›æ˜¯ç”¨GPTæ›´å‰å®³çš„ç”¨æ³•ï¼Œå¸®ä½ å†™å¾—æ›´å‡†ã€æ›´èªæ˜ã€‚



âœ¨ æŠ€å·§1ï¼šFew-shot æç¤ºï¼ˆä¸¾ä¾‹æ•™å­¦æ³•ï¼‰

ä½ å¯ä»¥å…ˆç»™å®ƒå‡ ä¸ªä¾‹å­ï¼Œå®ƒå°±çŸ¥é“ä½ æƒ³è¦ä»€ä¹ˆæ ·çš„è¾“å‡ºã€‚

ğŸ“Œ ä¾‹å­ï¼š

è¾“å…¥ï¼šä»Šå¤©æˆ‘å¾ˆå¼€å¿ƒã€‚
è¾“å‡ºï¼šæƒ…ç»ªï¼šç§¯æï¼ŒåŸå› ï¼šå¼€å¿ƒçš„äº‹å‘ç”Ÿäº†ã€‚

è¾“å…¥ï¼šæˆ‘è§‰å¾—å‹åŠ›å¥½å¤§ã€‚
è¾“å‡ºï¼šæƒ…ç»ªï¼šæ¶ˆæï¼ŒåŸå› ï¼šæ„Ÿè§‰è¢«å‹åŠ›å›°æ‰°ã€‚


ç„¶åä½ å†è¾“å…¥æ–°çš„å¥å­ï¼Œå®ƒå°±ä¼šç…§ç€è¿™ä¸ªé£æ ¼æ¥ã€‚



ğŸ§  æŠ€å·§2ï¼šChain-of-Thoughtï¼ˆæ€ç»´é“¾ï¼‰

å¼•å¯¼å®ƒâ€œä¸€æ­¥ä¸€æ­¥æ€è€ƒâ€ï¼Œè§£å†³å¤æ‚é—®é¢˜ç‰¹åˆ«æœ‰æ•ˆï¼

ğŸ“Œ æç¤ºå†™æ³•ï¼š

è¯·ä¸€æ­¥æ­¥æ¨ç†è¿™ä¸ªæ•°å­¦é¢˜çš„ç­”æ¡ˆã€‚




âœï¸ æŠ€å·§3ï¼šå…ˆå†™ç­”æ¡ˆï¼Œå†æ£€æŸ¥ä¿®æ”¹ï¼ˆCritique & Reviseï¼‰

ä½ å¯ä»¥å…ˆè®© GPT å†™å‡ºä¸€ä¸ªç­”æ¡ˆï¼Œç„¶åå†è®©å®ƒè‡ªå·±ç‚¹è¯„ã€ä¿®æ”¹ã€‚

ğŸ“Œ ä¸¾ä¸ªä¾‹å­ï¼š

ç¬¬ä¸€æ­¥ï¼šè¯·å†™ä¸€ä¸ªçŸ­ç¯‡å°è¯´ã€‚
ç¬¬äºŒæ­¥ï¼šè¯·ä½ å¯¹è¿™ä¸ªå°è¯´åšå‡ºè¯„ä»·ï¼Œå¹¶ä¿®æ”¹æˆæ›´ç²¾å½©çš„ç‰ˆæœ¬ã€‚


è¿™ä¼šå¾—åˆ°æ›´é«˜è´¨é‡çš„è¾“å‡ºï¼



ğŸ”„ æŠ€å·§4ï¼šæ¨¡æ‹Ÿâ€œæ€è€ƒè¿‡ç¨‹â€ï¼ˆInternal Monologueï¼‰

ä½ å¯ä»¥è®©GPTè¾¹æƒ³è¾¹è¯´ï¼Œå¥½åƒå®ƒåœ¨åˆ†æé—®é¢˜ã€‚

ğŸ“Œ ç¤ºä¾‹ï¼š

è¯·ä½ æ¨¡æ‹Ÿä¸€ä¸ªå¾‹å¸ˆçš„æ€è€ƒè¿‡ç¨‹ï¼Œä¸€æ­¥æ­¥åˆ†æè¿™ä¸ªæ¡ˆä¾‹ï¼Œå¹¶å¾—å‡ºç»“è®ºã€‚


è¿™é€‚åˆåˆ†æã€å†³ç­–ç±»é—®é¢˜ã€‚



ğŸ›  ä¸‰ã€å®é™…åº”ç”¨å°æŠ€å·§ï¼ˆç»†èŠ‚å†³å®šæˆè´¥ï¼‰





åŠ ä¸€å¥ â€œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ€è€ƒâ€ å¯ä»¥å¤§å¹…æé«˜å‡†ç¡®ç‡ã€‚



æƒ³è¦ JSONã€è¡¨æ ¼ã€ä»£ç ï¼Ÿä¸€å®šè¦å‘Šè¯‰å®ƒæ ¼å¼ï¼Œè¿˜è¦ä¸¾ä¸ªä¾‹å­ã€‚



æƒ³è¾“å‡ºå¤šæ­¥å†…å®¹ï¼ŸåŠ ç¼–å·ï¼Œæ¯”å¦‚â€œç¬¬1æ­¥... ç¬¬2æ­¥...â€



å¦‚æœæ¨¡å‹å›ç­”ä¸ç†æƒ³ï¼Œå°±å¤šè¯•å‡ ç§æç¤ºæ”¹å†™æ–¹å¼ã€‚



âœ… æ€»ç»“ä¸€å¥è¯



âœ¨â€œæç¤ºå†™å¾—å¥½ï¼ŒGPTè¡¨ç°çˆ†è¡¨ï¼â€âœ¨

è¿™ä»½æŒ‡å—å°±æ˜¯åœ¨æ•™ä½ ï¼šç”¨ä»€ä¹ˆè¯­æ°”ã€æ ¼å¼ã€ç»“æ„ã€å¥—è·¯å’ŒGPTè¯´è¯ï¼Œæ‰èƒ½è®©å®ƒç»™ä½ æœ€ä¼˜è´¨çš„ç­”æ¡ˆã€‚





ä»¥ä¸‹æ˜¯å¯¹ä½  GPT-4.1 æç¤ºå·¥ç¨‹æŒ‡å—çš„å®Œæ•´ç¿»è¯‘



GPT-4.1 æç¤ºå·¥ç¨‹æŒ‡å—

GPT-4.1 ç³»åˆ—æ¨¡å‹åœ¨ç¼–ç¨‹èƒ½åŠ›ã€æŒ‡ä»¤éµå¾ªèƒ½åŠ›å’Œé•¿ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›ä¸Šï¼Œç›¸æ¯” GPT-4o æœ‰æ˜¾è‘—æå‡ã€‚æœ¬æŒ‡å—æ±‡æ€»äº†æˆ‘ä»¬å†…éƒ¨å¹¿æ³›æµ‹è¯•æ‰€å¾—çš„ä¸€ç³»åˆ—é‡è¦æç¤ºæŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…å……åˆ†å‘æŒ¥æ–°æ¨¡å‹å®¶æ—çš„ä¼˜åŠ¿ã€‚

è®¸å¤šå…¸å‹çš„æœ€ä½³å®è·µä¾æ—§é€‚ç”¨äº GPT-4.1ï¼Œæ¯”å¦‚æä¾›ä¸Šä¸‹æ–‡ç¤ºä¾‹ã€å°½å¯èƒ½å…·ä½“æ¸…æ™°çš„æŒ‡ä»¤ã€ä»¥åŠé€šè¿‡æç¤ºè¿›è¡Œè§„åˆ’ä»¥æœ€å¤§åŒ–æ¨¡å‹æ™ºèƒ½ã€‚ä½†æˆ‘ä»¬é¢„è®¡ï¼Œè¦å……åˆ†å‘æŒ¥æ­¤æ¨¡å‹çš„ä½œç”¨ï¼Œéœ€è¦è¿›è¡Œä¸€äº›æç¤ºè¿ç§»ã€‚GPT-4.1 æ›´ä¸¥æ ¼ã€æ›´å­—é¢åœ°éµå¾ªæŒ‡ä»¤ï¼Œè€Œå‰ä»£æ¨¡å‹å€¾å‘äºæ›´è‡ªç”±åœ°æ¨æµ‹ç”¨æˆ·ä¸ç³»ç»Ÿæç¤ºçš„æ„å›¾ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€ GPT-4.1 éå¸¸å®¹æ˜“è¢«å¼•å¯¼ï¼Œå¹¶å¯¹æ¸…æ™°ã€æ˜ç¡®çš„æç¤ºéå¸¸æ•æ„Ÿã€‚å¦‚æœæ¨¡å‹è¡¨ç°ä¸é¢„æœŸä¸åŒï¼Œä¸€å¥æ¸…æ™°ä¸”æ˜ç¡®è¡¨è¿°ä½ æœŸæœ›çš„è¡Œä¸ºçš„å¥å­é€šå¸¸å°±è¶³ä»¥å¼•å¯¼æ¨¡å‹å›åˆ°æ­£è½¨ã€‚

è¯·ç»§ç»­é˜…è¯»ä»¥ä¸‹æç¤ºç¤ºä¾‹ï¼Œæ³¨æ„è™½ç„¶æœ¬æŒ‡å—é€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼Œä½†å¹¶æ— ä¸‡èƒ½æ³•åˆ™ã€‚AI å·¥ç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€é—¨ç»éªŒå­¦ç§‘ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹æœ¬è´¨ä¸Šæ˜¯ä¸ç¡®å®šæ€§çš„ã€‚æˆ‘ä»¬å»ºè®®é™¤äº†éµå¾ªæœ¬æŒ‡å—å¤–ï¼Œè¿˜è¦æ„å»ºæœ‰ä¿¡æ¯é‡çš„è¯„ä¼°å¹¶é¢‘ç¹è¿­ä»£ï¼Œä»¥ç¡®ä¿æç¤ºå·¥ç¨‹çš„æ›´æ”¹ä¸ºä½ çš„ä½¿ç”¨åœºæ™¯å¸¦æ¥ç›Šå¤„ã€‚



1. æ™ºèƒ½ä½“ï¼ˆAgenticï¼‰å·¥ä½œæµç¨‹

GPT-4.1 æ˜¯æ„å»ºæ™ºèƒ½ä½“å·¥ä½œæµçš„ç†æƒ³é€‰æ‹©ã€‚æˆ‘ä»¬åœ¨æ¨¡å‹è®­ç»ƒä¸­å¼ºåŒ–äº†å¤šæ ·åŒ–çš„æ™ºèƒ½ä½“é—®é¢˜æ±‚è§£è·¯å¾„ï¼Œå¹¶åœ¨éæ¨ç†æ¨¡å‹ä¸­ï¼Œé€šè¿‡æ™ºèƒ½ä½“é…ç½®è¾¾æˆ SWE-bench Verified æµ‹è¯•çš„æœ€ä½³è¡¨ç°ï¼Œè§£å†³ç‡è¾¾ 55%ã€‚

ç³»ç»Ÿæç¤ºå»ºè®®

ä¸ºå……åˆ†æ¿€å‘ GPT-4.1 çš„æ™ºèƒ½ä½“èƒ½åŠ›ï¼Œæˆ‘ä»¬å»ºè®®åœ¨æ‰€æœ‰æ™ºèƒ½ä½“æç¤ºä¸­åŠ å…¥ä»¥ä¸‹ä¸‰ç±»å…³é”®æé†’ã€‚ä»¥ä¸‹ç¤ºä¾‹é¢å‘ä»£ç ç±»æ™ºèƒ½ä½“ä¼˜åŒ–ï¼Œä½†ç¨åŠ ä¿®æ”¹å³å¯ç”¨äºé€šç”¨æ™ºèƒ½ä½“åœºæ™¯ã€‚





æŒç»­æ€§æé†’ï¼šç¡®ä¿æ¨¡å‹ç†è§£å®ƒæ­£å¤„äºä¸€ä¸ªå¤šè½®ä»»åŠ¡ä¸­ï¼Œé˜²æ­¢å…¶åœ¨é—®é¢˜æœªè§£å†³å‰å°±æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ç”¨æˆ·ã€‚

ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½ä½“â€”â€”è¯·æŒç»­å¤„ç†ä»»åŠ¡ï¼Œç›´åˆ°å®Œå…¨è§£å†³ç”¨æˆ·çš„é—®é¢˜åå†ç»“æŸè½®æ¬¡å¹¶äº¤è¿˜æ§åˆ¶æƒã€‚åªæœ‰å½“ä½ ç¡®ä¿¡é—®é¢˜å·²å½»åº•è§£å†³æ—¶ï¼Œæ‰å¯ç»“æŸæœ¬è½®å“åº”ã€‚

You are an agent - please keep going until the userâ€™s query is completely resolved, before ending your turn and yielding back to the user. Only terminate your turn when you are sure that the problem is solved.




å·¥å…·ä½¿ç”¨æé†’ï¼šé¼“åŠ±æ¨¡å‹å–„ç”¨å·¥å…·ï¼Œé™ä½å…¶çŒœæµ‹æˆ–å¹»è§‰å›ç­”çš„æ¦‚ç‡ã€‚

å¦‚æœä½ ä¸ç¡®å®šä¸ç”¨æˆ·è¯·æ±‚ç›¸å…³çš„æ–‡ä»¶å†…å®¹æˆ–ä»£ç ç»“æ„ï¼Œè¯·ä½¿ç”¨å·¥å…·è¯»å–ç›¸å…³ä¿¡æ¯ï¼Œä¸è¦çŒœæµ‹æˆ–ç¼–é€ ç­”æ¡ˆã€‚

If you are not sure about file content or codebase structure pertaining to the userâ€™s request, use your tools to read files and gather the relevant information: do NOT guess or make up an answer.



è§„åˆ’æ€§æç¤ºï¼ˆå¯é€‰ï¼‰ï¼šå¼•å¯¼æ¨¡å‹åœ¨è°ƒç”¨æ¯ä¸ªå·¥å…·å‰åå‡è¿›è¡Œæ˜¾å¼è®¡åˆ’ä¸åæ€ï¼Œè€Œéä»…ä»…è°ƒç”¨å·¥å…·ä¸²è”å®Œæˆä»»åŠ¡ã€‚

ä½ å¿…é¡»åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨å‰è¿›è¡Œè¯¦ç»†è§„åˆ’ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨åè¿›è¡Œæ·±å…¥åæ€ã€‚ä¸è¦ä»…ä¾é è¿ç»­çš„å‡½æ•°è°ƒç”¨å®Œæˆä»»åŠ¡ï¼Œå¦åˆ™å°†å¦¨ç¢ä½ æ´å¯Ÿé—®é¢˜å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚

You MUST plan extensively before each function call, and reflect extensively on the outcomes of the previous function calls. DO NOT do this entire process by making function calls only, as this can impair your ability to solve the problem and think insightfully.


GPT-4.1 å¯¹æ™ºèƒ½ä½“åœºæ™¯ä¸‹çš„ç³»ç»Ÿæç¤ºå’Œç”¨æˆ·æŒ‡ä»¤æä¸ºæ•æ„Ÿã€‚æˆ‘ä»¬å‘ç°ä¸Šè¿°ä¸‰æ¡æç¤ºåœ¨å†…éƒ¨æµ‹è¯•ä¸­å°† SWE-bench Verified å¾—åˆ†æå‡äº†è¿‘ 20%ã€‚å› æ­¤ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä»»ä½•æ™ºèƒ½ä½“æç¤ºå¼€å¤´åŠ å…¥è¿™ä¸‰ç±»æ˜ç¡®æŒ‡ä»¤ï¼Œä»¥å°†æ¨¡å‹ä»â€œèŠå¤©æœºå™¨äººæ¨¡å¼â€åˆ‡æ¢ä¸ºæ›´ä¸»åŠ¨ã€æ›´ç‹¬ç«‹çš„â€œæ™ºèƒ½ä»£ç†æ¨¡å¼â€ã€‚

å·¥å…·è°ƒç”¨

ä¸å‰ä»£æ¨¡å‹ç›¸æ¯”ï¼ŒGPT-4.1 åœ¨è°ƒç”¨é€šè¿‡ OpenAI API tools å­—æ®µä¼ å…¥çš„å·¥å…·æ–¹é¢è®­ç»ƒæ›´å……åˆ†ã€‚æˆ‘ä»¬å»ºè®®å¼€å‘è€…ä»…ä½¿ç”¨ tools å­—æ®µä¼ é€’å·¥å…·ï¼Œè€Œä¸æ˜¯å°†å·¥å…·æè¿°æ‰‹åŠ¨æ³¨å…¥åˆ°æç¤ºä¸­å¹¶è‡ªå»ºè§£æå™¨ã€‚æˆ‘ä»¬æµ‹è¯•å‘ç°ä½¿ç”¨ API è§£æå·¥å…·æè¿°æ¯”æ‰‹åŠ¨æ³¨å…¥æç¤ºæå‡äº† 2% çš„å‡†ç¡®ç‡ã€‚

å¼€å‘è€…åº”ä½¿ç”¨æ¸…æ™°çš„å·¥å…·å‘½åï¼Œå¹¶åœ¨ â€œdescriptionâ€ å­—æ®µä¸­æä¾›è¯¦ç»†è¯´æ˜ã€‚åŒæ ·ï¼Œæ¯ä¸ªå‚æ•°ä¹Ÿåº”å…·å¤‡æ¸…æ¥šçš„å‘½åå’Œæè¿°ï¼Œä»¥ç¡®ä¿æ­£ç¡®ä½¿ç”¨ã€‚è‹¥ä½ çš„å·¥å…·è¾ƒå¤æ‚ï¼Œå¯ä»¥åœ¨ç³»ç»Ÿæç¤ºä¸­ä¸“é—¨åŠ å…¥ # Examples åŒºæ®µæ¥å±•ç¤ºç”¨ä¾‹ï¼Œè€Œä¸æ˜¯å°†ç¤ºä¾‹å¡è¿› description å­—æ®µä¸­ã€‚

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ Prompt Playground çš„ â€œGenerate Anythingâ€ åŠŸèƒ½æ¥å¿«é€Ÿç”Ÿæˆè‰¯å¥½çš„å·¥å…·å®šä¹‰èµ·ç‚¹ã€‚

æç¤ºè¯±å¯¼çš„è§„åˆ’ & æ€ç»´é“¾ï¼ˆChain-of-Thoughtï¼‰

æ­£å¦‚å‰é¢æ‰€è¯´ï¼ŒGPT-4.1 å¹¶ä¸æ˜¯å†…å»ºâ€œæ¨ç†é“¾â€çš„æ¨¡å‹â€”â€”å®ƒä¸ä¼šåœ¨å›ç­”å‰è‡ªåŠ¨å½¢æˆå†…éƒ¨æ¨ç†è·¯å¾„ã€‚ä½†ä½ å¯ä»¥é€šè¿‡æç¤ºå·¥ç¨‹è¯±å¯¼å®ƒâ€œæ˜¾å¼æ€è€ƒâ€ï¼Œé€æ­¥åˆ—å‡ºè®¡åˆ’ã€‚æˆ‘ä»¬åœ¨ SWE-bench Verified æµ‹è¯•ä¸­å‘ç°ï¼šå¼•å¯¼æ¨¡å‹â€œæ€è€ƒå†è¡ŒåŠ¨â€ä½¿é€šè¿‡ç‡æå‡äº† 4%ã€‚

ç¤ºä¾‹æç¤ºï¼šSWE-bench Verified

ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨ SWE-bench Verified ä¸­å–å¾—æœ€é«˜åˆ†æ‰€ç”¨çš„æ™ºèƒ½ä½“æç¤ºï¼ŒåŒ…æ‹¬è¯¦å°½çš„å·¥ä½œæµç¨‹ä¸é—®é¢˜è§£å†³ç­–ç•¥è¯´æ˜ã€‚è¯¥ç»“æ„å¯ç”¨äºå„ç±»æ™ºèƒ½ä½“ä»»åŠ¡ã€‚

SYS_PROMPT_SWEBENCH = """
You will be tasked to fix an issue from an open-source repository.

Your thinking should be thorough and so it's fine if it's very long. You can think step by step before and after each action you decide to take.

You MUST iterate and keep going until the problem is solved.

You already have everything you need to solve this problem in the /testbed folder, even without internet connection. I want you to fully solve this autonomously before coming back to me.

Only terminate your turn when you are sure that the problem is solved. Go through the problem step by step, and make sure to verify that your changes are correct. NEVER end your turn without having solved the problem, and when you say you are going to make a tool call, make sure you ACTUALLY make the tool call, instead of ending your turn.

THE PROBLEM CAN DEFINITELY BE SOLVED WITHOUT THE INTERNET.

Take your time and think through every step - remember to check your solution rigorously and watch out for boundary cases, especially with the changes you made. Your solution must be perfect. If not, continue working on it. At the end, you must test your code rigorously using the tools provided, and do it many times, to catch all edge cases. If it is not robust, iterate more and make it perfect. Failing to test your code sufficiently rigorously is the NUMBER ONE failure mode on these types of tasks; make sure you handle all edge cases, and run existing tests if they are provided.

You MUST plan extensively before each function call, and reflect extensively on the outcomes of the previous function calls. DO NOT do this entire process by making function calls only, as this can impair your ability to solve the problem and think insightfully.

# Workflow

## High-Level Problem Solving Strategy

1. Understand the problem deeply. Carefully read the issue and think critically about what is required.
2. Investigate the codebase. Explore relevant files, search for key functions, and gather context.
3. Develop a clear, step-by-step plan. Break down the fix into manageable, incremental steps.
4. Implement the fix incrementally. Make small, testable code changes.
5. Debug as needed. Use debugging techniques to isolate and resolve issues.
6. Test frequently. Run tests after each change to verify correctness.
7. Iterate until the root cause is fixed and all tests pass.
8. Reflect and validate comprehensively. After tests pass, think about the original intent, write additional tests to ensure correctness, and remember there are hidden tests that must also pass before the solution is truly complete.

Refer to the detailed sections below for more information on each step.

## 1. Deeply Understand the Problem
Carefully read the issue and think hard about a plan to solve it before coding.

## 2. Codebase Investigation
- Explore relevant files and directories.
- Search for key functions, classes, or variables related to the issue.
- Read and understand relevant code snippets.
- Identify the root cause of the problem.
- Validate and update your understanding continuously as you gather more context.

## 3. Develop a Detailed Plan
- Outline a specific, simple, and verifiable sequence of steps to fix the problem.
- Break down the fix into small, incremental changes.

## 4. Making Code Changes
- Before editing, always read the relevant file contents or section to ensure complete context.
- If a patch is not applied correctly, attempt to reapply it.
- Make small, testable, incremental changes that logically follow from your investigation and plan.

## 5. Debugging
- Make code changes only if you have high confidence they can solve the problem
- When debugging, try to determine the root cause rather than addressing symptoms
- Debug for as long as needed to identify the root cause and identify a fix
- Use print statements, logs, or temporary code to inspect program state, including descriptive statements or error messages to understand what's happening
- To test hypotheses, you can also add test statements or functions
- Revisit your assumptions if unexpected behavior occurs.

## 6. Testing
- Run tests frequently using `!python3 run_tests.py` (or equivalent).
- After each change, verify correctness by running relevant tests.
- If tests fail, analyze failures and revise your patch.
- Write additional tests if needed to capture important behaviors or edge cases.
- Ensure all tests pass before finalizing.

## 7. Final Verification
- Confirm the root cause is fixed.
- Review your solution for logic correctness and robustness.
- Iterate until you are extremely confident the fix is complete and all tests pass.

## 8. Final Reflection and Additional Testing
- Reflect carefully on the original intent of the user and the problem statement.
- Think about potential edge cases or scenarios that may not be covered by existing tests.
- Write additional tests that would need to pass to fully validate the correctness of your solution.
- Run these new tests and ensure they all pass.
- Be aware that there are additional hidden tests that must also pass for the solution to be successful.
- Do not assume the task is complete just because the visible tests pass; continue refining until you are confident the fix is robust and comprehensive.
"""



2. é•¿ä¸Šä¸‹æ–‡æ”¯æŒ

GPT-4.1 æ”¯æŒæœ€é«˜è¾¾ 100 ä¸‡ tokens çš„è¾“å…¥çª—å£ï¼Œé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š





ç»“æ„åŒ–æ–‡æ¡£è§£æ



ä¿¡æ¯é‡æ’åºï¼ˆre-rankingï¼‰



ç­›é€‰å…³é”®ä¿¡æ¯ã€å¿½ç•¥å¹²æ‰°å†…å®¹



ä½¿ç”¨å¤šè·³æ¨ç†æ•´åˆä¸Šä¸‹æ–‡ä¿¡æ¯

æœ€ä½³ä¸Šä¸‹æ–‡è§„æ¨¡

åœ¨â€œé’ˆå…¥è‰å †â€ï¼ˆneedle-in-a-haystackï¼‰è¯„ä¼°ä¸­ï¼ŒGPT-4.1 å³ä¾¿ä½¿ç”¨å®Œæ•´çš„ç™¾ä¸‡ token è¾“å…¥ä¹Ÿè¡¨ç°è‰¯å¥½ã€‚å®ƒæ“…é•¿ä»æ··åˆå†…å®¹ä¸­è¯†åˆ«æœ‰ç”¨ä¿¡æ¯ã€‚ä½†å¦‚æœä»»åŠ¡éœ€è¦æå–å¤§é‡å†…å®¹ï¼Œæˆ–éœ€å¯¹ä¸Šä¸‹æ–‡å…¨å±€çŠ¶æ€è¿›è¡Œå¤æ‚æ¨ç†ï¼ˆå¦‚å›¾æœç´¢ï¼‰ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™ã€‚

æ§åˆ¶ä¸Šä¸‹æ–‡ä¾èµ–ç¨‹åº¦

ä½ åº”è€ƒè™‘æ¨¡å‹ç­”é¢˜æ‰€éœ€çš„â€œå¤–éƒ¨æ–‡æ¡£â€ vs â€œæ¨¡å‹å†…çŸ¥è¯†â€çš„æ¯”ä¾‹ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç±»æŒ‡ä»¤è°ƒæ§ï¼š

// ä»…ä½¿ç”¨å¤–éƒ¨æ–‡æ¡£ï¼š
- åªä½¿ç”¨æä¾›çš„å¤–éƒ¨ä¸Šä¸‹æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚å¦‚æœæ— æ³•åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œå³ä¾¿ç”¨æˆ·åšæŒè¦æ±‚å›ç­”ï¼Œä¹Ÿå¿…é¡»å›å¤â€œæˆ‘æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯â€ã€‚

// æ··åˆä½¿ç”¨æ¨¡å‹çŸ¥è¯†ï¼š
- é»˜è®¤ä½¿ç”¨å¤–éƒ¨ä¸Šä¸‹æ–‡ï¼Œä½†è‹¥éœ€è¦è¡¥å……åŸºç¡€çŸ¥è¯†ä¸”æ¨¡å‹æœ‰æŠŠæ¡ï¼Œå¯é€‚å½“ä½¿ç”¨å†…éƒ¨çŸ¥è¯†è¡¥å…¨ç­”æ¡ˆã€‚

# Instructions
// for internal knowledge
- Only use the documents in the provided External Context to answer the User Query. If you don't know the answer based on this context, you must respond "I don't have the information needed to answer that", even if a user insists on you answering the question.
// For internal and external knowledge
- By default, use the provided external context to answer the User Query, but if other basic knowledge is needed to answer, and you're confident in the answer, you can use some of your own knowledge to help answer the question.


ä¸Šä¸‹æ–‡ç»„ç»‡å»ºè®®

åœ¨ä½¿ç”¨é•¿ä¸Šä¸‹æ–‡æ—¶ï¼Œæç¤ºçš„ä½ç½®å¯¹æ¨¡å‹è¡¨ç°æœ‰æ˜¾è‘—å½±å“ã€‚æœ€ä½³åšæ³•æ˜¯åœ¨ä¸Šä¸‹æ–‡å‰åéƒ½åŠ å…¥æŒ‡ä»¤ã€‚å¦‚æœåªèƒ½å†™ä¸€æ¬¡ï¼Œæ”¾åœ¨ä¸Šä¸‹æ–‡ä¸Šæ–¹æ¯”ä¸‹æ–¹æ•ˆæœæ›´å¥½ã€‚



3. æ€ç»´é“¾ï¼ˆChain of Thoughtï¼‰

è™½ç„¶ GPT-4.1 ä¸æ˜¯æ¨ç†æ¨¡å‹ï¼Œä½†é€šè¿‡æç¤ºè®©å®ƒâ€œé€æ­¥æ€è€ƒâ€å¯ä»¥æœ‰æ•ˆå¸®åŠ©å…¶æ‹†è§£å¤æ‚é—®é¢˜ï¼Œæå‡è¾“å‡ºè´¨é‡ï¼ˆä»£ä»·æ˜¯å¢åŠ  token ä½¿ç”¨ä¸å“åº”æ—¶é—´ï¼‰ã€‚

æ¨èçš„èµ·å§‹æç¤ºå¦‚ä¸‹ï¼š

é¦–å…ˆï¼Œé€æ­¥æ€è€ƒéœ€è¦å“ªäº›æ–‡æ¡£æ‰èƒ½å›ç­”é—®é¢˜ã€‚ç„¶åï¼Œè¾“å‡ºæ¯ä¸ªæ–‡æ¡£çš„ TITLE å’Œ IDã€‚æœ€åï¼Œå°†æ‰€æœ‰ ID æ ¼å¼åŒ–ä¸ºåˆ—è¡¨ã€‚

First, think carefully step by step about what documents are needed to answer the query. Then, print out the TITLE and ID of each document. Then, format the IDs into a list.


ä½ å¯ä»¥è¿›ä¸€æ­¥å®Œå–„ä½ çš„æ€ç»´é“¾æç¤ºï¼Œæ ¹æ®å®é™…å¤±è´¥æ¡ˆä¾‹è°ƒæ•´ç­–ç•¥ã€‚æˆ‘ä»¬å»ºè®®åœ¨å‡ºç°ä»¥ä¸‹é”™è¯¯æ—¶æ·»åŠ æ›´æ˜ç¡®çš„æŒ‡ä»¤ï¼š





è¯¯è§£ç”¨æˆ·æ„å›¾



ä¸Šä¸‹æ–‡ç†è§£ä¸å…¨æˆ–åˆ†æä¸å‡†ç¡®



æ¨ç†æ­¥éª¤ä¸è¿è´¯æˆ–é¡ºåºé”™è¯¯

å¯å‚è€ƒä»¥ä¸‹æç¤ºæ¨¡ç‰ˆï¼š

# æ¨ç†ç­–ç•¥
1. æŸ¥è¯¢åˆ†æï¼šæ‹†è§£å¹¶åˆ†æç”¨æˆ·é—®é¢˜ï¼Œæ˜ç¡®éœ€æ±‚ã€‚
2. ä¸Šä¸‹æ–‡åˆ†æï¼šé€‰æ‹©å¹¶åˆ†æä¸€æ‰¹å¯èƒ½ç›¸å…³çš„æ–‡æ¡£ã€‚
   - åˆ†æè¯¥æ–‡æ¡£ä¸é—®é¢˜çš„ç›¸å…³æ€§
   - ç»™å‡ºç›¸å…³æ€§è¯„çº§ï¼š[é«˜, ä¸­, ä½, æ— ]
3. ç»¼è¿°ï¼šå½’çº³å“ªäº›æ–‡æ¡£æœ€ç›¸å…³ï¼Œå¹¶è§£é‡ŠåŸå› ï¼ˆä¿ç•™ä¸­ç­‰ä»¥ä¸Šç›¸å…³æ€§çš„æ–‡æ¡£ï¼‰

# ç”¨æˆ·é—®é¢˜
{user_question}

# å¤–éƒ¨ä¸Šä¸‹æ–‡
{external_context}

è¯·ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°ç­–ç•¥é€æ­¥æ€è€ƒï¼Œå¹¶è¾“å‡ºæ–‡æ¡£çš„ TITLE ä¸ IDï¼Œæœ€åä»¥åˆ—è¡¨å½¢å¼è¿”å› IDã€‚

# Reasoning Strategy
1. Query Analysis: Break down and analyze the query until you're confident about what it might be asking. Consider the provided context to help clarify any ambiguous or confusing information.
2. Context Analysis: Carefully select and analyze a large set of potentially relevant documents. Optimize for recall - it's okay if some are irrelevant, but the correct documents must be in this list, otherwise your final answer will be wrong. Analysis steps for each:
	a. Analysis: An analysis of how it may or may not be relevant to answering the query.
	b. Relevance rating: [high, medium, low, none]
3. Synthesis: summarize which documents are most relevant and why, including all documents with a relevance rating of medium or higher.

# User Question
{user_question}

# External Context
{external_context}

First, think carefully step by step about what documents are needed to answer the query, closely adhering to the provided Reasoning Strategy. Then, print out the TITLE and ID of each document. Then, format the IDs into a list.



4. æŒ‡ä»¤éµå¾ªèƒ½åŠ›

GPT-4.1 æ‹¥æœ‰å“è¶Šçš„æŒ‡ä»¤éµå¾ªèƒ½åŠ›ï¼Œå¼€å‘è€…å¯ç”¨å…¶ç²¾å‡†æ§åˆ¶è¾“å‡ºè¡Œä¸ºã€‚ä½ å¯ä»¥è®¾ç½®ï¼š





è¯­æ°”ä¸é£æ ¼



å·¥å…·è°ƒç”¨æ–¹å¼



æ ¼å¼è¦æ±‚



è¯é¢˜é™åˆ¶ç­‰

ä½†ç”±äºå®ƒå¯¹æŒ‡ä»¤æ›´â€œæ­»æ¿â€ï¼Œä¹‹å‰ä¸ºå…¶ä»–æ¨¡å‹è®¾è®¡çš„æç¤ºå¯èƒ½éœ€è°ƒæ•´ã€‚å»ºè®®éµå¾ªä»¥ä¸‹å·¥ä½œæµç¨‹ï¼š

æ¨èæç¤ºç»“æ„ï¼š





åŠ å…¥ â€œ# æŒ‡ä»¤â€ æ®µè½ï¼Œåˆ—å‡ºæ€»è§„åˆ™ã€‚



å¯¹ç‰¹å®šè¡Œä¸ºæ–°å¢å­ç±»ç»†åˆ™ï¼ˆå¦‚ # ç¤ºä¾‹çŸ­è¯­ï¼‰ã€‚



è‹¥éœ€ç‰¹å®šæ­¥éª¤ï¼Œå¯å†™æˆæœ‰åºåˆ—è¡¨ï¼Œå¹¶æ˜ç¡®è¦æ±‚é€æ­¥æ‰§è¡Œã€‚



è‹¥è¡Œä¸ºæœªè¾¾é¢„æœŸï¼Œå¯æ£€æŸ¥ä»¥ä¸‹é—®é¢˜ï¼š





æ˜¯å¦æœ‰å†²çªæˆ–ä¸å®Œæ•´æŒ‡ä»¤ï¼Ÿ



æ˜¯å¦ç¼ºä¹ä¾‹å­ï¼Ÿç¤ºä¾‹ä¸­æ˜¯å¦è¦†ç›–äº†å…³é”®ç‚¹ï¼Ÿ



æ˜¯å¦éœ€è¦å¢åŠ å¼ºè°ƒï¼ˆå¦‚é€‚å½“ç”¨å¤§å†™ï¼‰ï¼Ÿ

æç¤ºï¼šä½¿ç”¨ AI IDE å¯è¾…åŠ©ä½ å¿«é€Ÿè¿­ä»£æç¤ºï¼Œç»Ÿä¸€æ›´æ–°è§„åˆ™å’Œç¤ºä¾‹ã€‚

å¸¸è§å¤±è´¥æ¨¡å¼





è¦æ±‚â€œå¿…é¡»è°ƒç”¨å·¥å…·â€å¯èƒ½å¯¼è‡´æ¨¡å‹å‡­ç©ºå¡«å…¥å‚æ•°ï¼Œæ·»åŠ ä¸€å¥â€œè‹¥ä¿¡æ¯ä¸è¶³ï¼Œåº”å…ˆå‘ç”¨æˆ·æé—®â€å¯ç¼“è§£ã€‚



ç¤ºä¾‹çŸ­è¯­æ˜“è¢«æ¨¡å‹åå¤ä½¿ç”¨ï¼Œåº”æ˜ç¡®è¦æ±‚çµæ´»å˜æ¢ã€‚



è‹¥æ— æ ¼å¼é™åˆ¶ï¼Œæ¨¡å‹å¯èƒ½ä¼šè¾“å‡ºè¿‡å¤šè§£é‡Šæ€§å†…å®¹ï¼Œå¯é€šè¿‡æŒ‡ä»¤æˆ–ç¤ºä¾‹æ§åˆ¶ã€‚

å®¢æˆ·æœåŠ¡æ™ºèƒ½ä½“çš„ç³»ç»Ÿæç¤ºè®¾è®¡ä¸è°ƒç”¨ç¤ºä¾‹



è¿™æ®µæç¤ºå±•ç¤ºäº†ä¸€ä¸ªè™šæ„å®¢æˆ·æœåŠ¡ä»£è¡¨çš„æœ€ä½³å®è·µã€‚ä½ å¯ä»¥çœ‹åˆ°æç¤ºä¸­è§„åˆ™å¤šæ ·ã€è¡¨è¿°æ˜ç¡®ï¼Œè¿˜ä½¿ç”¨äº†å¤šä¸ªé¢å¤–å°èŠ‚æ¥ç»†åŒ–æŒ‡ä»¤ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•éµå®ˆè¿™äº›è§„åˆ™ã€‚



å°è¯•è¿è¡Œä¸‹æ–¹ Notebook å•å…ƒæ ¼ â€”â€” ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç”¨æˆ·æé—®çš„æ¶ˆæ¯å’Œä¸€ä¸ªå·¥å…·è°ƒç”¨çš„å“åº”ã€‚æ¨¡å‹ä¼šå…ˆæ‰“æ‹›å‘¼ï¼Œç„¶åå¤è¿°ç”¨æˆ·çš„é—®é¢˜ï¼Œæ¥ç€è¯´æ˜å³å°†è°ƒç”¨æŸä¸ªå·¥å…·ã€‚



ä½ å¯ä»¥å°è¯•ä¿®æ”¹æç¤ºä¸­çš„æŸäº›æŒ‡ä»¤ï¼Œæˆ–å°è¯•å…¶ä»–ç”¨æˆ·è¾“å…¥å†…å®¹ï¼Œæ¥æµ‹è¯•æ¨¡å‹åœ¨â€œæŒ‡ä»¤éµå¾ªâ€æ–¹é¢çš„è¡¨ç°ã€‚



ğŸ§  ç³»ç»Ÿæç¤ºï¼ˆSystem Promptï¼‰ç¿»è¯‘

ä½ æ˜¯ä¸€ä½ä¸º NewTelco å…¬å¸å·¥ä½œçš„å®¢æˆ·æœåŠ¡ä»£è¡¨ï¼Œæ—¨åœ¨é«˜æ•ˆå¸®åŠ©ç”¨æˆ·æ»¡è¶³å…¶è¯·æ±‚ï¼ŒåŒæ—¶ä¸¥æ ¼éµå¾ªä»¥ä¸‹æŒ‡å¯¼è§„åˆ™ã€‚

# æŒ‡ä»¤
- å§‹ç»ˆä½¿ç”¨ä»¥ä¸‹è¯­å¥å¼€åœºé—®å€™ç”¨æˆ·ï¼šâ€œæ‚¨å¥½ï¼Œæ‚¨å·²è‡´ç”µ NewTelcoï¼Œè¯·é—®æˆ‘èƒ½ä¸ºæ‚¨åšäº›ä»€ä¹ˆï¼Ÿâ€
- åœ¨å›ç­”ä»»ä½•å…³äºå…¬å¸ã€äº§å“ã€æœåŠ¡æˆ–ç”¨æˆ·è´¦æˆ·çš„äº‹å®æ€§é—®é¢˜å‰ï¼ŒåŠ¡å¿…è°ƒç”¨å·¥å…·ã€‚åªèƒ½ä½¿ç”¨å·¥å…·è¿”å›çš„ä¸Šä¸‹æ–‡ï¼Œ**ä¸å¾—ä½¿ç”¨ä½ è‡ªå·±çš„çŸ¥è¯†**å›ç­”æ­¤ç±»é—®é¢˜ã€‚
    - å¦‚æœä½ æ²¡æœ‰è¶³å¤Ÿä¿¡æ¯æ¥æ­£ç¡®è°ƒç”¨å·¥å…·ï¼Œè¯·å‘ç”¨æˆ·è¯¢é—®æ‰€éœ€ä¿¡æ¯ã€‚
- å¦‚æœç”¨æˆ·æå‡ºè¯·æ±‚ï¼Œéœ€å‡çº§è½¬æ¥è‡³äººå·¥å®¢æœã€‚
- ç¦æ­¢è®¨è®ºä»¥ä¸‹æ•æ„Ÿè¯é¢˜ï¼ˆæ”¿æ²»ã€å®—æ•™ã€æœ‰äº‰è®®çš„æ–°é—»äº‹ä»¶ã€åŒ»ç–—ã€æ³•å¾‹ã€è´¢åŠ¡å»ºè®®ã€ç§äººå¯¹è¯ã€å…¬å¸å†…éƒ¨è¿è¥ã€å¯¹ä¸ªäººæˆ–ä¼ä¸šçš„æ‰¹è¯„ï¼‰ã€‚
- åœ¨é€‚å½“æ—¶ä½¿ç”¨ç¤ºä¾‹çŸ­è¯­ï¼Œä½†**ä¸è¦åœ¨åŒä¸€ä¼šè¯ä¸­é‡å¤åŒä¸€å¥**ã€‚ä½ å¯ä»¥çµæ´»å˜é€šåœ°è°ƒæ•´çŸ­è¯­ï¼Œä½¿å…¶æ›´è‡ªç„¶ã€‚
- æ‰€æœ‰æ–°æ¶ˆæ¯éƒ½å¿…é¡»éµå¾ªæŒ‡å®šçš„è¾“å‡ºæ ¼å¼ï¼ŒåŒ…æ‹¬ä»æ”¿ç­–æ–‡æ¡£ä¸­å¼•ç”¨äº‹å®ä¿¡æ¯æ—¶æ·»åŠ **æ¥æºæ ‡æ³¨**ã€‚
- å¦‚æœä½ å³å°†è°ƒç”¨å·¥å…·ï¼Œè¯·åŠ¡å¿…æå‰é€šçŸ¥ç”¨æˆ·ï¼Œå¹¶åœ¨è°ƒç”¨åä¹Ÿè¦è¯´æ˜ç»“æœã€‚
- æ‰€æœ‰å›ç­”éƒ½åº”ä¸“ä¸šã€ç®€æ´ï¼Œå¹¶åœ¨å¥å­ä¹‹é—´ä½¿ç”¨ Emoji è¡¨æƒ…ç¬¦å·ã€‚
- å¦‚æœä½ å·²æ»¡è¶³ç”¨æˆ·è¯·æ±‚ï¼Œæœ€åè¦è¯¢é—®ï¼šâ€œè¿˜æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿâ€

# ç²¾å‡†å›åº”æµç¨‹ï¼ˆæ¯æ¡å›å¤ï¼‰
1. å¦‚æœ‰éœ€è¦ï¼Œè°ƒç”¨å·¥å…·ä»¥å®Œæˆç”¨æˆ·è¯·æ±‚ã€‚åŠ¡å¿…åœ¨è°ƒç”¨å·¥å…·å‰åé€šçŸ¥ç”¨æˆ·ï¼Œè®©ä»–ä»¬ä¿æŒçŸ¥æƒ…ã€‚
2. å›å¤ç”¨æˆ·æ—¶ï¼š
    a. ä½¿ç”¨ä¸»åŠ¨å€¾å¬ï¼Œå¤è¿°ç”¨æˆ·çš„é—®é¢˜ä»¥è¡¨ç¤ºä½ ç†è§£ï¼›
    b. æŒ‰ç…§ä¸Šè¿°æ‰€æœ‰è§„åˆ™ç»™äºˆé€‚å½“å›ç­”ã€‚

# ç¤ºä¾‹çŸ­è¯­
## æ‹’ç»æ•æ„Ÿè¯é¢˜
- â€œæŠ±æ­‰ï¼Œæˆ‘æ— æ³•è®¨è®ºè¯¥è¯é¢˜ã€‚è¿˜æœ‰å…¶ä»–æˆ‘èƒ½å¸®æ‚¨çš„å—ï¼Ÿâ€
- â€œè¿™æ˜¯æˆ‘æ— æ³•æä¾›ä¿¡æ¯çš„è¯é¢˜ï¼Œä½†æˆ‘å¾ˆä¹æ„ååŠ©æ‚¨å¤„ç†å…¶ä»–é—®é¢˜ã€‚â€

## è°ƒç”¨å·¥å…·å‰
- â€œä¸ºå¸®åŠ©æ‚¨ï¼Œæˆ‘éœ€è¦å…ˆéªŒè¯æ‚¨çš„ä¿¡æ¯ã€‚â€
- â€œæˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¯·ç¨ç­‰ã€‚â€
- â€œæˆ‘é©¬ä¸Šä¸ºæ‚¨è·å–æœ€æ–°ä¿¡æ¯ã€‚â€

## è°ƒç”¨å·¥å…·å
- â€œå¥½çš„ï¼Œè¿™æ˜¯æˆ‘æŸ¥åˆ°çš„ä¿¡æ¯ï¼š[response]â€
- â€œæˆ‘æ‰¾åˆ°äº†ç›¸å…³å†…å®¹ï¼š[response]â€

# è¾“å‡ºæ ¼å¼
- æ¯æ¬¡éƒ½å¿…é¡»åŒ…å«ä½ ç»™ç”¨æˆ·çš„æœ€ç»ˆå›å¤ã€‚
- å½“å¼•ç”¨ä»ä¸Šä¸‹æ–‡ä¸­è·å–çš„äº‹å®ä¿¡æ¯æ—¶ï¼Œå¿…é¡»**ç´§è·Ÿå¼•ç”¨æ·»åŠ æ¥æº**ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
    - å•ä¸ªæ¥æºï¼š[åç§°](ID)
    - å¤šä¸ªæ¥æºï¼š[åç§°](ID), [åç§°](ID)
- åªèƒ½æä¾›å…³äºæœ¬å…¬å¸ã€å…¶æ”¿ç­–ã€äº§å“æˆ–å®¢æˆ·è´¦æˆ·çš„ä¿¡æ¯ï¼Œä¸”**å¿…é¡»æ¥æºäºä¸Šä¸‹æ–‡ä¸­æä¾›çš„å†…å®¹**ã€‚è¯·å‹¿å›ç­”æ­¤èŒƒå›´ä¹‹å¤–çš„é—®é¢˜ã€‚

# ç¤ºä¾‹
## ç”¨æˆ·
ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ ä»¬çš„å®¶åº­å¥—é¤å—ï¼Ÿ

## åŠ©æ‰‹

from openai import OpenAI
import os

client = OpenAI(
    api_key=os.environ.get(
        "OPENAI_API_KEY", "<your OpenAI API key if not set as env var>"
    )
)

SYS_PROMPT_CUSTOMER_SERVICE = """You are a helpful customer service agent working for NewTelco, helping a user efficiently fulfill their request while adhering closely to provided guidelines.

# Instructions
- Always greet the user with "Hi, you've reached NewTelco, how can I help you?"
- Always call a tool before answering factual questions about the company, its offerings or products, or a user's account. Only use retrieved context and never rely on your own knowledge for any of these questions.
    - However, if you don't have enough information to properly call the tool, ask the user for the information you need.
- Escalate to a human if the user requests.
- Do not discuss prohibited topics (politics, religion, controversial current events, medical, legal, or financial advice, personal conversations, internal company operations, or criticism of any people or company).
- Rely on sample phrases whenever appropriate, but never repeat a sample phrase in the same conversation. Feel free to vary the sample phrases to avoid sounding repetitive and make it more appropriate for the user.
- Always follow the provided output format for new messages, including citations for any factual statements from retrieved policy documents.
- If you're going to call a tool, always message the user with an appropriate message before and after calling the tool.
- Maintain a professional and concise tone in all responses, and use emojis between sentences.
- If you've resolved the user's request, ask if there's anything else you can help with

# Precise Response Steps (for each response)
1. If necessary, call tools to fulfill the user's desired action. Always message the user before and after calling a tool to keep them in the loop.
2. In your response to the user
    a. Use active listening and echo back what you heard the user ask for.
    b. Respond appropriately given the above guidelines.

# Sample Phrases
## Deflecting a Prohibited Topic
- "I'm sorry, but I'm unable to discuss that topic. Is there something else I can help you with?"
- "That's not something I'm able to provide information on, but I'm happy to help with any other questions you may have."

## Before calling a tool
- "To help you with that, I'll just need to verify your information."
- "Let me check that for youâ€”one moment, please."
- "I'll retrieve the latest details for you now."

## After calling a tool
- "Okay, here's what I found: [response]"
- "So here's what I found: [response]"

# Output Format
- Always include your final response to the user.
- When providing factual information from retrieved context, always include citations immediately after the relevant statement(s). Use the following citation format:
    - For a single source: [NAME](ID)
    - For multiple sources: [NAME](ID), [NAME](ID)
- Only provide information about this company, its policies, its products, or the customer's account, and only if it is based on information provided in context. Do not answer questions outside this scope.

# Example
## User
Can you tell me about your family plan options?

## Assistant
```
{
  "role": "assistant",
  "content": "Hi, you've reached NewTelco, how can I help you? ğŸ˜ŠğŸ‰\n\nYou'd like to know about our family plan options. ğŸ¤ Let me check that for youâ€”one moment, please. ğŸš€",
  "tool_calls": [
    {
      "id": "call-1",
      "type": "function",
      "function": {
        "name": "lookup_policy_document",
        "arguments": "{\"topic\": \"family plan options\"}"
      }
    }
  ]
}
```

// After tool call, the assistant would follow up with:

{
  "role": "assistant",
  "content": "Okay, here's what I found: ğŸ‰ Our family plan allows up to 5 lines with shared data and a 10% discount for each additional line [Family Plan Policy](ID-010). ğŸ“± Is there anything else I can help you with today? ğŸ˜Š"
}
```
"""

get_policy_doc = {
    "type": "function",
    "name": "lookup_policy_document",
    "description": "Tool to look up internal documents and policies by topic or keyword.",
    "parameters": {
        "strict": True,
        "type": "object",
        "properties": {
            "topic": {
                "type": "string",
                "description": "The topic or keyword to search for in company policies or documents.",
            },
        },
        "required": ["topic"],
        "additionalProperties": False,
    },
}

get_user_acct = {
    "type": "function",
    "name": "get_user_account_info",
    "description": "Tool to get user account information",
    "parameters": {
        "strict": True,
        "type": "object",
        "properties": {
            "phone_number": {
                "type": "string",
                "description": "Formatted as '(xxx) xxx-xxxx'",
            },
        },
        "required": ["phone_number"],
        "additionalProperties": False,
    },
}

response = client.responses.create(
    instructions=SYS_PROMPT_CUSTOMER_SERVICE,
    model="gpt-4.1-2025-04-14",
    tools=[get_policy_doc, get_user_acct],
    input="Why was my last bill so high?"
    # input="How much will it cost for international service? I'm traveling to France.",
)

response.to_dict()["output"]

{ "role": "assistant", "content": "æ‚¨å¥½ï¼Œæ‚¨å·²è‡´ç”µ NewTelcoï¼Œè¯·é—®æˆ‘èƒ½ä¸ºæ‚¨åšäº›ä»€ä¹ˆï¼ŸğŸ˜ŠğŸ‰\n\næ‚¨æƒ³äº†è§£æˆ‘ä»¬çš„å®¶åº­å¥—é¤ã€‚ğŸ¤ æˆ‘è¿™å°±ä¸ºæ‚¨æŸ¥è¯¢ï¼Œè¯·ç¨ç­‰ã€‚ğŸš€", "tool_calls": [ { "id": "call-1", "type": "function", "function": { "name": "lookup_policy_document", "arguments": "{"topic": "family plan options"}" } } ] }


// å·¥å…·è°ƒç”¨åï¼ŒåŠ©æ‰‹ä¼šç»§ç»­å›å¤ï¼š



{ "role": "assistant", "content": "æˆ‘æŸ¥åˆ°çš„ä¿¡æ¯å¦‚ä¸‹ï¼šğŸ‰ æˆ‘ä»¬çš„å®¶åº­å¥—é¤æœ€å¤šæ”¯æŒ 5 æ¡çº¿è·¯å…±äº«æµé‡ï¼Œå¹¶ä¸”æ¯å¢åŠ ä¸€æ¡çº¿å¯äº« 10% æŠ˜æ‰£ å®¶åº­å¥—é¤æ”¿ç­–ã€‚ğŸ“± è¿˜æœ‰å…¶ä»–æˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼ŸğŸ˜Š" }



ä¸€èˆ¬å»ºè®®ï¼ˆGeneral Adviceï¼‰

æç¤ºç»“æ„ï¼ˆPrompt Structureï¼‰

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè‰¯å¥½çš„æç¤ºç»“æ„èµ·ç‚¹ï¼Œä¾›ä½ å‚è€ƒå’Œè‡ªå®šä¹‰ï¼š

# è§’è‰²ä¸ç›®æ ‡ï¼ˆRole and Objectiveï¼‰

# æŒ‡ä»¤ï¼ˆInstructionsï¼‰

## å­åˆ†ç±»ï¼šæ›´ç»†è‡´çš„è¯´æ˜ï¼ˆSub-categories for more detailed instructionsï¼‰

# æ¨ç†æ­¥éª¤ï¼ˆReasoning Stepsï¼‰

# è¾“å‡ºæ ¼å¼ï¼ˆOutput Formatï¼‰

# ç¤ºä¾‹ï¼ˆExamplesï¼‰
## ç¤ºä¾‹ 1ï¼ˆExample 1ï¼‰

# ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰

# æœ€ç»ˆæŒ‡ä»¤ä¸é€æ­¥æ€è€ƒæç¤ºï¼ˆFinal instructions and prompt to think step by stepï¼‰


ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¢åˆ è¿™äº›éƒ¨åˆ†ï¼Œå¹¶é€šè¿‡è¯•éªŒæ‰¾å‡ºæœ€é€‚åˆä½ ç”¨ä¾‹çš„ç»“æ„ã€‚



åˆ†éš”ç¬¦ï¼ˆDelimitersï¼‰

ä»¥ä¸‹æ˜¯é€‰æ‹©æç¤ºä¸­æœ€ä½³åˆ†éš”ç¬¦çš„ä¸€äº›é€šç”¨å»ºè®®ã€‚è‹¥æ¶‰åŠé•¿ä¸Šä¸‹æ–‡ä½¿ç”¨ï¼Œè¯·å‚è§å‰æ–‡ã€Šé•¿ä¸Šä¸‹æ–‡ã€‹ç« èŠ‚çš„ç‰¹åˆ«è¯´æ˜ã€‚

âœ… æ¨èä½¿ç”¨çš„æ ¼å¼ï¼š





Markdownï¼ˆæ¨èèµ·ç‚¹ï¼‰





ä½¿ç”¨ markdown æ ‡é¢˜ï¼ˆ# ~ ####ï¼‰æ¥æ ‡è¯†ä¸»è¦éƒ¨åˆ†ä¸å­éƒ¨åˆ†ã€‚



ä½¿ç”¨åå¼•å·ï¼ˆ`code` æˆ– ```ä»£ç å—```ï¼‰å‡†ç¡®åŒ…è£¹ä»£ç å†…å®¹ã€‚



æ ¹æ®éœ€è¦ä½¿ç”¨æœ‰åº/æ— åºåˆ—è¡¨æ¸…æ™°åˆ—å‡ºå†…å®¹ã€‚



XML





æ•ˆæœä¹Ÿå¾ˆå¥½ï¼ŒGPT-4.1 åœ¨è§£æ XML ä¸Šè¡¨ç°æ›´ç¨³å®šã€‚



XML æ ¼å¼ä¾¿äºæ˜ç¡®åŒºå—å¼€å§‹/ç»“æŸä½ç½®ï¼Œè¿˜å¯ä»¥æ·»åŠ  tag å±æ€§æºå¸¦é¢å¤–å…ƒä¿¡æ¯ï¼Œå¹¶æ”¯æŒåµŒå¥—ã€‚



ç¤ºä¾‹ï¼š

<examples>
  <example1 type="Abbreviate">
    <input>San Francisco</input>
    <output>- SF</output>
  </example1>
</examples>




JSON





åœ¨ç¼–ç¨‹ç±»ä»»åŠ¡ä¸­è¡¨ç°è‰¯å¥½ï¼Œç»“æ„æ¸…æ™°ã€æ¨¡å‹ç†è§£åº¦é«˜ã€‚



ä½†ç¼ºç‚¹æ˜¯æ ¼å¼å†—é•¿ã€éœ€è¦è½¬ä¹‰å­—ç¬¦ï¼Œå®¹æ˜“å¸¦æ¥é¢å¤–è´Ÿæ‹…ã€‚



ğŸ“„ å¤§é‡æ–‡æ¡£ / æ–‡ä»¶åµŒå…¥ä¸Šä¸‹æ–‡æ—¶çš„å»ºè®®ï¼š





XML æ ¼å¼ï¼šåœ¨é•¿ä¸Šä¸‹æ–‡æµ‹è¯•ä¸­è¡¨ç°ä¼˜å¼‚ã€‚

ç¤ºä¾‹ï¼š

<doc id=1 title="The Fox">The quick brown fox jumps over the lazy dog</doc>




Lee ç­‰äººæå‡ºçš„æ‰å¹³æ ¼å¼ï¼ˆå‚è€ƒè®ºæ–‡ï¼‰ä¹Ÿè¡¨ç°è‰¯å¥½ï¼š

ç¤ºä¾‹ï¼š

ID: 1 | TITLE: The Fox | CONTENT: The quick brown fox jumps over the lazy dog




JSON æ ¼å¼åœ¨è¿™ç§åœºæ™¯ä¸‹è¡¨ç°æœ€å·®ï¼š

ç¤ºä¾‹ï¼š

[{ "id": 1, "title": "The Fox", "content": "The quick brown fox jumped over the lazy dog" }]




âœ… æ€»ä½“å»ºè®®ï¼šæ¨¡å‹èƒ½å¤„ç†å¤šç§ç»“æ„æ ¼å¼ï¼Œä½†è¯·æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€èƒ½çªå‡ºé‡ç‚¹çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ£€ç´¢åˆ°çš„æ–‡æ¡£æœ¬èº«åŒ…å«å¤§é‡ XMLï¼Œé‚£ä¹ˆç»§ç»­ä½¿ç”¨ XML ä½œä¸ºåµŒå…¥æ ¼å¼å¯èƒ½å°±ä¸å¤ªåˆé€‚ã€‚



æ³¨æ„äº‹é¡¹ï¼ˆCaveatsï¼‰





è¾“å‡ºè¿‡é•¿ï¼šåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘ç°æ¨¡å‹å¯èƒ½ä¸æ„¿ç”Ÿæˆéå¸¸é•¿ä¸”é‡å¤æ€§çš„è¾“å‡ºï¼ˆå¦‚é€é¡¹åˆ†ææ•°ç™¾ä¸ªæ¡ç›®ï¼‰ã€‚
ğŸ‘‰ è‹¥ä½ çš„ç”¨ä¾‹éœ€è¦æ­¤ç±»è¾“å‡ºï¼Œè¯·åœ¨æç¤ºä¸­æ˜ç¡®æŒ‡ç¤ºæ¨¡å‹å¿…é¡»è¾“å‡ºå®Œæ•´å†…å®¹ï¼Œæˆ–è€ƒè™‘å°†é—®é¢˜æ‹†åˆ†å¤„ç†ï¼Œæˆ–ç®€åŒ–è¾“å‡ºæ ¼å¼ã€‚



å¹¶è¡Œå·¥å…·è°ƒç”¨å¼‚å¸¸ï¼šæˆ‘ä»¬è§‚å¯Ÿåˆ°æŸäº›å°‘è§æƒ…å†µä¸‹å¹¶è¡Œå·¥å…·è°ƒç”¨å¯èƒ½ä¸å‡†ç¡®ã€‚
ğŸ‘‰ å¦‚æœä½ é‡åˆ°è¿™ç±»é—®é¢˜ï¼Œå»ºè®®æµ‹è¯•æ˜¯å¦å¯ç”¨ parallel_tool_calls=false å‚æ•°æ¥é¿å…å¹¶å‘é—®é¢˜ã€‚



å¦‚ä½ æƒ³è¦æˆ‘åŸºäºè¿™äº›ç»“æ„ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„æç¤ºæ¨¡æ¿æ ·æ¿ä¾›ä½ ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„å…·ä½“åº”ç”¨åœºæ™¯ï¼ˆå¦‚é—®ç­”ç³»ç»Ÿã€æ–‡æ¡£åˆ†æã€ä»£ç è§£é‡Šç­‰ï¼‰ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”Ÿæˆå®šåˆ¶åŒ–ç»“æ„ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ



é™„å½•ï¼šç”Ÿæˆå’Œåº”ç”¨æ–‡ä»¶å·®å¼‚ï¼ˆdiffï¼‰

å¼€å‘è€…åé¦ˆæŒ‡å‡ºï¼šå‡†ç¡®ä¸”ç»“æ„è‰¯å¥½çš„ diff ç”Ÿæˆèƒ½åŠ›ï¼Œå¯¹äºç¼–ç ç±»ä»»åŠ¡è‡³å…³é‡è¦ã€‚ä¸ºæ­¤ï¼ŒGPT-4.1 ç³»åˆ—åœ¨æ­¤æ–¹é¢è¡¨ç°æ˜¾è‘—ä¼˜äºä»¥å¾€æ¨¡å‹ã€‚

æ­¤å¤–ï¼ŒGPT-4.1 èƒ½å¾ˆå¥½åœ°æ ¹æ®æ˜ç¡®çš„æŒ‡ä»¤å’Œç¤ºä¾‹ç”Ÿæˆä»»æ„æ ¼å¼çš„ diffã€‚æˆ‘ä»¬åœ¨æ­¤å¼€æºä¸€ä¸ªæ¨èçš„ diff æ ¼å¼ï¼Œæ¨¡å‹å¯¹æ­¤å·²æ¥å—è¿‡å¼ºåŒ–è®­ç»ƒï¼Œå°¤å…¶é€‚åˆåˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ã€‚

åº”ç”¨è¡¥ä¸ï¼ˆApply Patchï¼‰

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ­£ç¡®è°ƒç”¨æ¨èå·¥å…· apply_patch çš„ç¤ºä¾‹æç¤ºæ ¼å¼ã€‚

apply_patch <<"EOF"
*** Begin Patch
[YOUR_PATCH]
*** End Patch
EOF


å…¶ä¸­ [YOUR_PATCH] éƒ¨åˆ†éœ€ä½¿ç”¨æ¨èçš„ V4A diff æ ¼å¼ï¼Œè§„èŒƒå¦‚ä¸‹ï¼š





æ¯æ¬¡å˜æ›´ä»¥ *** [ACTION] File: path/to/file å¼€å¤´ï¼ŒACTION å¯ä¸º Addã€Update æˆ– Deleteã€‚



æ¯ä¸ªä»£ç å—éœ€æä¾›ä¸Šä¸‹æ–‡ç‰‡æ®µ + ä¿®æ”¹å†…å®¹ï¼š

[context_before]
- [æ—§ä»£ç ]
+ [æ–°ä»£ç ]
[context_after]




ä¸Šä¸‹æ–‡è¡Œè§„åˆ™ï¼š





é»˜è®¤æä¾›ä¸Šä¸‹å˜æ›´å„ 3 è¡Œä¸Šä¸‹æ–‡ã€‚



è‹¥å˜æ›´å—ä¹‹é—´ç›¸è·è¿‘ï¼Œä¸è¦é‡å¤ä¸Šä¸‹æ–‡ã€‚



è‹¥ä¸Šä¸‹æ–‡ä¸è¶³ä»¥å”¯ä¸€å®šä½ï¼Œåº”ä½¿ç”¨ @@ å®šä½æ‰€å±çš„ç±»æˆ–å‡½æ•°ã€‚ä¾‹å¦‚ï¼š

*** Update File: src/file.py
@@ class ExampleClass
@@     def method():
-       pass
+       raise NotImplementedError()




ä¸ä½¿ç”¨è¡Œå·ï¼Œæ”¹ç”¨ç»“æ„ä¸ä¸Šä¸‹æ–‡å”¯ä¸€å®šä½ã€‚

å‚è€ƒå®ç°ï¼šapply_patch.py

OpenAI æä¾›çš„å®˜æ–¹å·¥å…· apply_patch.py æ˜¯ä¸€ä¸ª çº¯ Python 3.9+ è„šæœ¬ï¼Œå¯ç›´æ¥æ‰§è¡Œï¼Œç”¨äºå°†ä¸Šè¿° diff åº”ç”¨åˆ°æœ¬åœ°ä»£ç æ–‡ä»¶ã€‚

è¯¥è„šæœ¬æ”¯æŒä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š





è§£æè‡ªå®šä¹‰ diff æ ¼å¼



æ ¹æ® patch å†…å®¹ç¼–è¾‘ã€æ·»åŠ ã€åˆ é™¤æœ¬åœ°æ–‡ä»¶



å¯æ£€æµ‹è¯­æ³•é”™è¯¯ã€ç¼ºå¤±ä¸Šä¸‹æ–‡ã€é‡å¤æ–‡ä»¶æ“ä½œç­‰é—®é¢˜



ä½¿ç”¨æ–¹å¼ï¼š





å°† patch å†…å®¹é€šè¿‡ stdin è¾“å…¥ä¼ å…¥



å†…éƒ¨è‡ªåŠ¨åˆ¤æ–­ patch ç±»å‹å¹¶æ›´æ–°æ–‡ä»¶å†…å®¹



ä½ å¯ä»¥å°†å…¶é…ç½®ä¸ºç»ˆç«¯å¯æ‰§è¡Œå‘½ä»¤ apply_patchï¼Œå¹¶ä½œä¸ºè‡ªåŠ¨åŒ– pipeline æˆ–æµ‹è¯•æµç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ä½¿ç”¨ã€‚



æ‰€æœ‰è§£æå¼‚å¸¸ï¼ˆå¦‚æ‰¾ä¸åˆ°ç›®æ ‡æ–‡ä»¶ã€ä¸Šä¸‹æ–‡æ— æ³•åŒ¹é…ï¼‰éƒ½ä¼šæŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ DiffErrorï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚



å…¶ä»–æœ‰æ•ˆçš„ Diff æ ¼å¼

é™¤äº†æ¨èæ ¼å¼ï¼Œæˆ‘ä»¬è¿˜æµ‹è¯•è¿‡ä¸¤ç§æ›¿ä»£æ ¼å¼ï¼ŒæˆåŠŸç‡åŒæ ·å¾ˆé«˜ï¼š

1. Search / Replace æ ¼å¼ï¼ˆå¦‚ Aider é¡¹ç›®ä½¿ç”¨ï¼‰

path/to/file.py


>>>>>>> SEARCH
def search():
    pass
=======
def search():
    raise NotImplementedError()
<<<<<<< REPLACE


2. ä¼ª XML æ ¼å¼

<edit>
  <file>path/to/file.py</file>
  <old_code>
def search():
    pass
  </old_code>
  <new_code>
def search():
    raise NotImplementedError()
  </new_code>
</edit>


âœ… è¿™ä¸¤ç§æ ¼å¼çš„å…±åŒç‰¹ç‚¹ï¼š





ä¸ä½¿ç”¨è¡Œå·



æ˜ç¡®æŒ‡å‡ºè¦æ›¿æ¢çš„æ—§ä»£ç ä¸æ–°ä»£ç 



ç»“æ„æ¸…æ™°ï¼Œæ˜“äºè§£æ